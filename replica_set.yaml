version: '3'

services:
  urlshortener:
    build: .
    container_name: urlshortener
    ports:
    - 8080:8080
    restart: always
  mongodb1:
    image: mongo:latest
    restart: always
    container_name: mongodb1
    volumes:
      - mongodata1:/data/db
    expose:
      - "27017"
    entrypoint: [ "/usr/bin/mongod", "--replSet", "rsmongo", "--bind_ip_all"]

  mongodb2:
    image: mongo:latest
    restart: always
    container_name: mongodb2
    volumes:
      - mongodata2:/data/db
    expose:
      - "27017"
    entrypoint: [ "/usr/bin/mongod", "--replSet", "rsmongo", "--bind_ip_all"]

  mongodb3:
    image: mongo:latest
    restart: always
    container_name: mongodb3
    volumes:
      - mongodata3:/data/db
    expose:
      - "27017"
    entrypoint: [ "/usr/bin/mongod", "--replSet", "rsmongo", "--bind_ip_all" ]
  redis:
    image: redis:latest
    restart: always
    container_name: urlcache
    volumes:
      - redisdata:/data/db
    expose:
      - "6379"
volumes:
  mongodata1:
  mongodata2:
  mongodata3:
  redisdata: